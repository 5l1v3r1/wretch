!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.wretch=r()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)},r=function(e,n,o){if(void 0===o&&(o=!1),!e||!n||"object"!=typeof e||"object"!=typeof n)return e;var i=t({},e);for(var s in n)n.hasOwnProperty(s)&&(n[s]instanceof Array&&e[s]instanceof Array?i[s]=o?e[s].concat(n[s]):n[s]:"object"==typeof n[s]&&"object"==typeof e[s]?i[s]=r(e[s],n[s],o):i[s]=n[s]);return i},e={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(t,r){for(var e=void 0===r?{}:r,n=e.doThrow,o=void 0===n||n,i=e.instance,s=void 0!==i&&i,u=[],c=2;c<arguments.length;c++)u[c-2]=arguments[c];var a=this.polyfills[t]||("undefined"!=typeof self?self[t]:null)||("undefined"!=typeof global?global[t]:null);if(o&&!a)throw new Error(t+" is not defined");return s&&a?new(a.bind.apply(a,[void 0].concat(u))):a}},n=function(t,r,e,n){if(!t.getEntriesByName)return!1;var i=t.getEntriesByName(r);return!!(i&&i.length>0)&&(e(i.reverse()[0]),n.clearMeasures&&n.clearMeasures(r),o.callbacks.delete(r),o.callbacks.size<1&&(o.observer.disconnect(),n.clearResourceTimings&&n.clearResourceTimings()),!0)},o={callbacks:new Map,observer:null,observe:function(t,r){if(t&&r){var i=e.polyfill("performance",{doThrow:!1});(function(t,r){return!o.observer&&t&&r&&(o.observer=new r(function(r){o.callbacks.forEach(function(e,o){n(r,o,e,t)})}),t.clearResourceTimings&&t.clearResourceTimings()),o.observer})(i,e.polyfill("PerformanceObserver",{doThrow:!1}))&&(n(i,t,r,i)||(o.callbacks.size<1&&o.observer.observe({entryTypes:["resource","measure"]}),o.callbacks.set(t,r)))}}},i=function(){function n(t,r,e,n,o,i){void 0===e&&(e=new Map),void 0===n&&(n=[]),void 0===o&&(o=[]),void 0===i&&(i=[]),this._url=t,this._options=r,this._catchers=e,this._resolvers=n,this._middlewares=o,this._deferredChain=i}return n.factory=function(t,r){return void 0===t&&(t=""),void 0===r&&(r={}),new n(t,r)},n.prototype.selfFactory=function(t){var r=void 0===t?{}:t,e=r.url,o=void 0===e?this._url:e,i=r.options,s=void 0===i?this._options:i,u=r.catchers,c=void 0===u?this._catchers:u,a=r.resolvers,f=void 0===a?this._resolvers:a,l=r.middlewares,p=void 0===l?this._middlewares:l,h=r.deferredChain;return new n(o,s,c,f,p,void 0===h?this._deferredChain:h)},n.prototype.defaults=function(t,n){return void 0===n&&(n=!1),e.defaults=n?r(e.defaults,t):t,this},n.prototype.errorType=function(t){return e.errorType=t,this},n.prototype.polyfills=function(r){return e.polyfills=t({},e.polyfills,r),this},n.prototype.url=function(t,r){if(void 0===r&&(r=!1),r)return this.selfFactory({url:t});var e=this._url.split("?");return this.selfFactory({url:e.length>1?e[0]+t+"?"+e[1]:this._url+t})},n.prototype.options=function(t,e){return void 0===e&&(e=!0),this.selfFactory({options:e?r(this._options,t):t})},n.prototype.query=function(t,r){return void 0===r&&(r=!1),this.selfFactory({url:s(this._url,t,r)})},n.prototype.headers=function(t){return this.selfFactory({options:r(this._options,{headers:t})})},n.prototype.accept=function(t){return this.headers({Accept:t})},n.prototype.content=function(t){return this.headers({"Content-Type":t})},n.prototype.auth=function(t){return this.headers({Authorization:t})},n.prototype.catcher=function(t,r){var e=new Map(this._catchers);return e.set(t,r),this.selfFactory({catchers:e})},n.prototype.signal=function(r){return this.selfFactory({options:t({},this._options,{signal:r.signal})})},n.prototype.resolve=function(t,r){return void 0===r&&(r=!1),this.selfFactory({resolvers:r?[t]:this._resolvers.concat([t])})},n.prototype.defer=function(t,r){return void 0===r&&(r=!1),this.selfFactory({deferredChain:r?[t]:this._deferredChain.concat([t])})},n.prototype.middlewares=function(t,r){return void 0===r&&(r=!1),this.selfFactory({middlewares:r?t:this._middlewares.concat(t)})},n.prototype.method=function(n,i,s){void 0===i&&(i={}),void 0===s&&(s=null);var u=s?"object"==typeof s?this.json(s):this.body(s):this;return function(t){var n=t._url,i=t._catchers,s=t._resolvers,u=t._middlewares,c=t._options,a=r(e.defaults,c),f=e.polyfill("AbortController",{doThrow:!1,instance:!0});!a.signal&&f&&(a.signal=f.signal);var l=function(t){return function(r){return 0===t.length?r:1===t.length?t[0](r):t.reduceRight(function(e,n,o){return o===t.length-2?n(e(r)):n(e)})}}(u)(e.polyfill("fetch"))(n,a),p=l.then(function(t){return t.ok?t:t[e.errorType||"text"]().then(function(r){var n=new Error(r);throw n[e.errorType||"text"]=r,n.status=t.status,n.response=t,n})}),h=function(r){return r.catch(function(r){if(i.has(r.status))return i.get(r.status)(r,t);if(i.has(r.name))return i.get(r.name)(r,t);throw r})},d=function(t){return function(r){return h(t?p.then(function(r){return r&&r[t]()}).then(function(t){return t&&r&&r(t)||t}):p.then(function(t){return t&&r&&r(t)||t}))}},y={res:d(null),json:d("json"),blob:d("blob"),formData:d("formData"),arrayBuffer:d("arrayBuffer"),text:d("text"),perfs:function(t){return l.then(function(r){return o.observe(r.url,t)}),y},setTimeout:function(t,r){return void 0===r&&(r=f),setTimeout(function(){return r.abort()},t),y},controller:function(){return[f,y]},error:function(t,r){return i.set(t,r),y},badRequest:function(t){return y.error(400,t)},unauthorized:function(t){return y.error(401,t)},forbidden:function(t){return y.error(403,t)},notFound:function(t){return y.error(404,t)},timeout:function(t){return y.error(408,t)},internalError:function(t){return y.error(500,t)},onAbort:function(t){return y.error("AbortError",t)}};return s.reduce(function(r,e){return e(r,t)},y)}(u._deferredChain.reduce(function(t,r){return r(t,t._url,t._options)},u).options(t({},i,{method:n})))},n.prototype.get=function(t){return this.method("GET",t)},n.prototype.delete=function(t){return this.method("DELETE",t)},n.prototype.put=function(t,r){return this.method("PUT",r,t)},n.prototype.post=function(t,r){return this.method("POST",r,t)},n.prototype.patch=function(t,r){return this.method("PATCH",r,t)},n.prototype.head=function(t){return this.method("HEAD",t)},n.prototype.opts=function(t){return this.method("OPTIONS",t)},n.prototype.body=function(r){return this.selfFactory({options:t({},this._options,{body:r})})},n.prototype.json=function(t){return this.content("application/json").body(JSON.stringify(t))},n.prototype.formData=function(t){return this.body(function(t){var r=e.polyfill("FormData",{instance:!0});for(var n in t)if(t[n]instanceof Array)for(var o=0,i=t[n];o<i.length;o++){var s=i[o];r.append(n+"[]",s)}else r.append(n,t[n]);return r}(t))},n.prototype.formUrl=function(t){return this.body("string"==typeof t?t:(r=t,Object.keys(r).map(function(t){var e=r[t];return e instanceof Array?e.map(function(r){return u(t,r)}).join("&"):u(t,e)}).join("&"))).content("application/x-www-form-urlencoded");var r},n}(),s=function(t,r,n){var o;if("string"==typeof r)o=r;else{var i=e.polyfill("URLSearchParams",{instance:!0});for(var s in r)if(r[s]instanceof Array)for(var u=0,c=r[s];u<c.length;u++){var a=c[u];i.append(s,a)}else i.append(s,r[s]);o=i.toString()}var f=t.split("?");return n||f.length<2?f[0]+"?"+o:t+"&"+o};function u(t,r){return encodeURIComponent(t)+"="+encodeURIComponent("object"==typeof r?JSON.stringify(r):""+r)}var c=i.factory;return c.default=i.factory,c});
//# sourceMappingURL=wretch.js.map
